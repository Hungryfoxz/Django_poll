{% extends 'base.html' %}
{% block content %}
<!-- ############################################### PUSHER JS  ###################################################################-->
<!-- Pusher Integration is done here ... -->
<script>

    // Enable pusher logging - don't include this in production
    Pusher.logToConsole = true;

    var pusher = new Pusher('2cd0f0edd98809e00ff2', {
    cluster: 'ap2'
    });

    var channel = pusher.subscribe('{{user.id}}');
    channel.bind('my-event', function(data) {
       //alert(JSON.stringify(data));
       document.getElementById("ms").innerHTML = " ";
       alert(data.message)
       document.getElementById("vote_btn").disabled = false;
       document.getElementById("vote_btn").innerHTML = "New Vote";
       document.getElementById("ms").innerHTML = "One user Voted Successfully !"; 
       document.getElementById("p-id").innerHTML = "Click below to allow the user to submit his vote.";
       document.getElementById("spinner").style.display = "none";
    });
</script>
<!--  ############################################  PUSHER JS ENDING  ######################################################-->
</head>

<body>
<!--  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   Preciding panel starts here  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  -->
    <!--Preciding officer panel..-->
    <main>

    <div class="my_glass_container">

        <div class="preciding-inside-glass">

        <div class="preciding-header">
            <h1>Actions of the Preciding Officer</h1>
        </div>

        <div class="preciding-form-button-main">
            <!--<form action=" " method="post">
                {% csrf_token%}-->
            <div>
                <p id="p-id">Click below to allow the user to submit his vote.</p>
                <div class="preciding-form-button-main-inside">            
                    <!--<a href="/admitted_from_po">--><button onclick="new_vote()" class="btn bt" id="vote_btn">New Vote</button></a>
                </div>
            </div>
            <!--</form>-->
        </div>
        <!--          %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%            -->
        <!--_____________________The bottom to buttons to show the results and the close voting button .________________________. -->
        <div class="preciding-bottom-buttons">
            <div class="preciding-tables-button">
                <p>Get the total results here.</p>
                <div class="preciding-form-button-main-inside">
                <a href="/aGlkZGVuLXJlc3VsdC1wYW5lbAoK"><button class="btn">Total Vote</button></a>
                </div>
            </div>
            <div class="preciding-logout-button">
            <p>End the session and Logout.</p>
                <div class="preciding-form-button-main-inside">
                <a href="/logout"><button class="btn">Close Vote</button></a>
                </div>
            </div>
        </div>
    </div>
   </div> 
  <!--  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  -->  
  <!--  ___________________________________________________Messages____________________________________________________________  -->

            <div class="preciding-messages">
                <ul>
                    <li>
                        <h5 id="ms">Welcome! {{ user }}</h5>
                        <h5 id="clock"></h5>
                        
                    </li>
                    <div  id="spinner" class="spinner">
                        <div class="sp-3balls"></div>
                    </div>
                </ul>
            </div>
<!--   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  -->
<!-- _________________________________________Rotating circles background animation .._________________________________________ -->
        <div class="clocks">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
<!--  Digital clock goes here .. -->

</main>
<!--########################################     Only for super user  ###########################################################-->
<!-- _______________________________________      Super user only   ______________________________________________________-->
{% if user.is_superuser %}
    <div class="super-user-area">
        <div class="clr-h5">
            <h5>Clear all vote to Zero.</h5>
         </div>
         <div class="clr-btn" style="align-items: center;">
             <button onclick="clear_me()" class="btn" id="clr">Reset Vote</button>
         </div>
    </div>
{% endif %}

<!--$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$-->
<!-- _______________________________________________Java script goes here .._______________________________________________________ -->
<script>
    // The analog clock goes here.......
    function currentTime() {
    var date = new Date(); /* creating object of Date class */
    var hour = date.getHours();
    var min = date.getMinutes();
    var sec = date.getSeconds();
    hour = updateTime(hour);
    min = updateTime(min);
    sec = updateTime(sec);
    document.getElementById("clock").innerText = hour + " : " + min + " : " + sec; /* adding time to the div */
      var t = setTimeout(function(){ currentTime() }, 1000); /* setting timer */
    }
    function updateTime(k) {
        if (k < 10) {
        return "0" + k;
        }
        else {
        return k;
        }
    }
    currentTime(); /* calling currentTime() function to initiate the process */
   
    //@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@//
     //_________________________________________Voter add button function ...___________________________________________//
    function new_vote(){
        //console.log("Hi");
        let xhr = new XMLHttpRequest();
        xhr.open('GET',"/admitted_from_po");
        xhr.send();
        //console.log(1);
        document.getElementById("ms").innerHTML = " The Voter can vote Now !";
        //console.log(2);
        setTimeout(function(){
                document.getElementById("ms").innerHTML = " Waiting for the Voter to vote Now !";
            }, 6000);
        document.getElementById("vote_btn").disabled = true;
        document.getElementById("vote_btn").innerHTML = "Waiting";
        document.getElementById("p-id").innerHTML = "Waiting for the voter to Submit his/her Vote .";
        document.getElementById("spinner").style.display = "inline-block";
    }
    //@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@//
    //clear button for the superuser ....placed here ....
    function clear_me(){
        let message = "You are about to clear all the votes from the Candidates . Are you sure you want to perform this action ."
        var reply = confirm(message);
        if(reply){
            var again_reply = confirm("Are you really sure!");
            if(again_reply){
                var name = prompt("What is your username?");
                if(name == '{{user}}'){
                    const confirmation = prompt("Write 'CONFIRM' to confirm.");
                    const str_compare = "CONFIRM"
                    if(confirmation === str_compare){
                        //console.log(111)
                        let xhttp = new XMLHttpRequest();
                        xhttp.open('GET',"/clear_votes");
                        xhttp.send();
                        alert("Success! All the votes are cleared from the database.");
                    }else{
                        alert("Please try again and write the word 'CONFIRM' to confirm your choice.")
                    }
                }else{
                    alert("Wrong username!")
                }
                //alert("Success! All the votes are cleared from the database.")
            }
        }
    }
</script>
<!-- __________________________________________________  END  ____________________________________________________________-->
{% endblock content %}



